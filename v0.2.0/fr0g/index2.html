<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>fr0gnet ‚Ä¢ fr0g Protocol Community Feed (Testnet)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/13.3.0/stellar-sdk.min.js"></script>
  <style>
    :root {
      --bg: #0a0f1a;
      --card: #111827;
      --accent: #00eaff;
      --accent-dark: #00bfff;
      --text: #e0f7ff;
      --text-light: #94a3b8;
      --border: #1e293b;
      --glow: rgba(0,234,255,0.12);
      --popup-overlay: rgba(0,0,0,0.92);
    }
    html[data-theme="light"] {
      --bg: #f8fafc;
      --card: #ffffff;
      --accent: #00bfff;
      --accent-dark: #0099cc;
      --text: #0f172a;
      --text-light: #64748b;
      --border: #e2e8f0;
      --glow: rgba(0,191,255,0.18);
      --popup-overlay: rgba(15,23,42,0.88);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      line-height: 1.6;
      transition: background 0.4s ease, color 0.4s ease;
      padding-bottom: 70px;
    }
    header {
      position: relative;
      text-align: center;
      padding: 2.8rem 1rem 1.6rem;
      background: linear-gradient(180deg, rgba(10,15,26,0.95) 0%, var(--bg) 100%);
      border-bottom: 1px solid var(--border);
    }
    .logo-placeholder {
      width: 112px; height: 112px;
      margin: 0 auto 1rem;
      background: rgba(0,234,255,0.08);
      border-radius: 50%;
      border: 3px dashed var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.35rem;
      color: var(--text-light);
      font-weight: 600;
      letter-spacing: 1px;
    }
    h1 {
      font-size: 3.1rem;
      color: var(--accent);
      margin-bottom: 0.4rem;
      font-weight: 700;
      letter-spacing: -0.7px;
    }
    .subtitle {
      color: var(--text-light);
      font-size: 1.1rem;
      max-width: 640px;
      margin: 0 auto 0.6rem;
      font-weight: 500;
    }
    .github-link {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .github-link:hover { text-decoration: underline; }
    .theme-toggle {
      position: absolute;
      top: 1.8rem;
      right: 1.2rem;
      width: 48px; height: 48px;
      background: var(--card);
      border: 2px solid var(--border);
      color: var(--accent);
      border-radius: 50%;
      font-size: 1.55rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px var(--glow);
    }
    .theme-toggle:hover { transform: rotate(25deg); border-color: var(--accent); box-shadow: 0 0 25px var(--glow); }

    .tabs {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 0.7rem;
      padding: 1.2rem 1rem 0.8rem;
      scrollbar-width: none;
    }
    .tabs::-webkit-scrollbar { display: none; }
    .tab {
      flex-shrink: 0;
      padding: 0.75rem 1.6rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 9999px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.98rem;
      white-space: nowrap;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .tab.active,
    .tab:hover {
      background: var(--accent);
      color: #000;
      border-color: var(--accent);
      box-shadow: 0 0 25px var(--glow);
      transform: translateY(-2px);
    }

    #feed-container, #upload-container, #id-container {
      max-width: 620px;
      margin: 0 auto;
      padding: 1rem 1rem 2rem;
    }
    .feed {
      display: flex;
      flex-direction: column;
      gap: 2.4rem;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 25px 55px rgba(0,0,0,0.45), 0 0 45px var(--glow);
      border-color: var(--accent);
    }
    .preview {
      height: 260px;
      background: #0a0f1a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8.5rem;
      position: relative;
      overflow: hidden;
    }
    .preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.92);
    }
    .preview::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.55));
    }
    .card-content {
      padding: 1.8rem 1.6rem 1.4rem;
    }
    .description {
      font-size: 1.32rem;
      font-weight: 600;
      line-height: 1.35;
      margin-bottom: 1rem;
      color: var(--text);
    }
    .id-index {
      font-family: monospace;
      font-size: 0.97rem;
      color: var(--accent);
      margin-bottom: 0.6rem;
    }
    .time {
      font-size: 0.92rem;
      color: var(--text-light);
    }
    .post-actions {
      display: flex;
      justify-content: space-around;
      margin-top: 1.4rem;
      padding-top: 1.2rem;
      border-top: 1px solid var(--border);
      font-size: 1.4rem;
    }

    .section-box {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 2rem 1.8rem;
      box-shadow: 0 12px 40px rgba(0,0,0,0.3);
    }
    .section-box h2 {
      color: var(--accent);
      text-align: center;
      margin-bottom: 1.8rem;
      font-size: 1.65rem;
    }
    input, select, textarea {
      width: 100%;
      padding: 1rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      color: var(--text);
      font-size: 1.05rem;
      margin-bottom: 1rem;
    }
    textarea { resize: vertical; min-height: 120px; }
    .char-count {
      text-align: right;
      font-size: 0.85rem;
      color: var(--text-light);
      margin-top: -8px;
      margin-bottom: 1.2rem;
    }
    button.primary {
      width: 100%;
      padding: 1.1rem;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 9999px;
      font-weight: 700;
      font-size: 1.15rem;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      padding: 8px 0 4px;
      z-index: 1000;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-light);
      font-size: 0.78rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .nav-item.active { color: var(--accent); }
    .nav-item span { font-size: 1.65rem; margin-bottom: 2px; }

    .footer {
      max-width: 620px;
      margin: 3rem auto 1rem;
      padding: 0 1.5rem;
      text-align: center;
      color: var(--text-light);
      font-size: 0.9rem;
      opacity: 0.85;
    }

    .popup {
      position: fixed;
      inset: 0;
      background: var(--popup-overlay);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(12px);
    }
    .popup-content {
      background: var(--card);
      border: 1px solid var(--accent);
      border-radius: 24px;
      width: 94%;
      max-width: 520px;
      max-height: 92vh;
      overflow: hidden;
      box-shadow: 0 0 90px rgba(0,234,255,0.3);
    }
    @media (max-width: 480px) {
      h1 { font-size: 2.7rem; }
      .preview { height: 220px; font-size: 7rem; }
      .feed { gap: 2rem; }
    }
  </style>
</head>
<body>
  <header>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">‚òÄÔ∏è</button>
    <div class="logo-placeholder">fr0g</div>
    <h1>fr0gnet</h1>
    <p class="subtitle">fr0g Protocol ‚Ä¢ Decentralized community uploads on Stellar Testnet ‚Ä¢ built for a free and open internet</p>
    <a href="https://github.com/fr0g-protocol" target="_blank" class="github-link">GitHub ‚Üí</a>
  </header>

  <div class="tabs">
    <button class="tab active" data-cat="ALL" onclick="showSection('ALL')">All</button>
    <button class="tab" data-cat="IMAGES" onclick="showSection('IMAGES')">Images</button>
    <button class="tab" data-cat="VIDEOS" onclick="showSection('VIDEOS')">Videos</button>
    <button class="tab" data-cat="WEBSITES" onclick="showSection('WEBSITES')">Websites</button>
    <button class="tab" data-cat="TEXT" onclick="showSection('TEXT')">Text</button>
    <button class="tab" data-cat="RAW" onclick="showSection('RAW')">Raw</button>
    <button class="tab" data-cat="UPLOAD" onclick="showSection('UPLOAD')">Upload</button>
    <button class="tab" data-cat="ID" onclick="showSection('ID')">My ID</button>
  </div>

  <!-- FEED -->
  <div id="feed-container">
    <div class="feed" id="feed"></div>
  </div>

  <!-- UPLOAD -->
  <div id="upload-container" style="display:none;">
    <div class="section-box">
      <h2>‚úçÔ∏è Post to fr0gnet</h2>
      <select id="upload-category">
        <option value="TEXT">üìù Text</option>
        <option value="IMAGES">üñºÔ∏è Images</option>
        <option value="VIDEOS">üé• Videos</option>
        <option value="WEBSITES">üåê Websites</option>
        <option value="RAW">üìÑ Raw</option>
      </select>
      <input type="number" id="upload-index" placeholder="Index number (e.g. 42)" min="1" value="42">
      <textarea id="upload-desc" maxlength="25" placeholder="Write something... (max 25 chars)"></textarea>
      <div id="char-count" class="char-count">25/25</div>

      <div style="display:flex;gap:12px;">
        <button onclick="showManual()" class="primary" style="flex:1;background:#475569;">üìã Manual (any wallet)</button>
        <button onclick="connectFreighter()" id="freighter-btn" class="primary" style="flex:1;">üöÄ Real Upload with Freighter</button>
      </div>

      <div id="connected-status" style="display:none;margin-top:1.5rem;padding:1.2rem;background:rgba(0,234,255,0.1);border-radius:16px;text-align:center;">
        Connected: <span id="connected-pk" style="font-family:monospace;color:var(--accent);"></span><br><br>
        <button onclick="realPost()" class="primary" style="width:auto;padding:0.9rem 2.2rem;">‚úÖ Post Now (Real Stellar Transaction)</button>
      </div>

      <div id="upload-preview" style="display:none; margin-top:2rem; padding:1.8rem; background:rgba(0,234,255,0.06); border-radius:20px; border:1px solid var(--accent); font-size:0.98rem; line-height:1.6;"></div>
    </div>
  </div>

  <!-- ID -->
  <div id="id-container" style="display:none;">
    <div class="section-box">
      <h2>üîë Your fr0g ID</h2>
      <p style="text-align:center; color:var(--text-light); margin-bottom:1.6rem;">Your Stellar wallet address becomes your fr0g ID automatically when you post</p>
      
      <input type="text" id="stellar-input" placeholder="Paste Stellar Public Key (G...) or leave empty for random" maxlength="56">
      <button onclick="generateID()" class="primary">Use this key</button>
      <button onclick="generateRandomID()" class="primary" style="margin-top:0.8rem; background:#1f2937; color:var(--accent);">üé≤ Generate Random fr0g ID</button>

      <div id="id-result" style="display:none; margin-top:2rem; padding:1.8rem; background:var(--bg); border-radius:20px; text-align:center;">
        <div style="font-size:1.4rem; margin-bottom:0.8rem;">Your fr0g ID</div>
        <div id="fr0g-output" style="font-family:monospace; font-size:1.28rem; color:var(--accent); word-break:break-all; padding:1rem; background:rgba(0,234,255,0.08); border-radius:16px;"></div>
        <button onclick="copyFr0gID()" style="margin-top:1.2rem; background:var(--accent); color:#000; border:none; padding:0.8rem 2rem; border-radius:9999px; font-weight:700;">Copy ID</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <p><strong>fr0g Protocol</strong> ‚Äî fully decentralized on Stellar Testnet.<br>Real uploads via Freighter or any Stellar wallet.</p>
    <div style="margin-top:1.5rem; font-size:0.85rem;">Testnet ‚Ä¢ Built for a free and open internet</div>
  </footer>

  <div class="bottom-nav">
    <div class="nav-item active" onclick="showSection('ALL')"><span>üè†</span><div>Home</div></div>
    <div class="nav-item" onclick="showSection('UPLOAD')"><span>‚úçÔ∏è</span><div>Post</div></div>
    <div class="nav-item" onclick="showSection('ID')"><span>üîë</span><div>ID</div></div>
  </div>

  <div class="popup" id="popup">
    <div class="popup-content">
      <div class="popup-header" style="padding:1.4rem 1.8rem;">
        <h2 id="popup-title" style="margin:0; font-size:1.65rem;">Post Details</h2>
        <button onclick="closePopup()" style="background:transparent; border:none; font-size:2rem; color:var(--text-light); cursor:pointer;">√ó</button>
      </div>
      <div class="popup-body" id="popup-body" style="padding:2rem;"></div>
    </div>
  </div>

  <script>
    const HORIZON = "https://horizon-testnet.stellar.org";
    const LIMIT = 50;
    const UPDATE_INTERVAL = 15000;
    const INDEXERS = {
      IMAGES: 'fr0gar7b4wscthfrqofckuq22clb3usofiud75gozxe26mqavyisrc5bemcg',
      VIDEOS: 'fr0gmypk54u3b5zytuzhwdbpxcyems234siebxa5wf2htz62smg4hbrtz5ag',
      WEBSITES: 'fr0gey3nkjwxfi3olj2opkjwzxg2prjxwyld3rxthfuzqd5ssyzisbr3fcbg',
      TEXT: 'fr0g64n6okdmub2vqiiqmupwdtclsqakkbm3idbaz6c3kliddivpgfeetldg',
      RAW: 'fr0gcqkdfplmirjr5wxkez75mubdwow3i2ishskhgnesq4iyiishafeef2dg',
    };
    const EMOJI_MAP = { IMAGES: 'üñºÔ∏è', VIDEOS: 'üé•', WEBSITES: 'üåê', TEXT: 'üìù', RAW: 'üìÑ' };

    let currentFilter = 'ALL';
    window.currentPublicKey = null;

    function getPreviewHTML(item) {
      if (item.category === 'IMAGES') {
        const seed = (item.index % 800) + 100;
        return `<img src="https://picsum.photos/id/${seed}/800/600" alt="preview">`;
      }
      return EMOJI_MAP[item.category] || 'üì¶';
    }

    function fr0gToStellar(id) {
      if (!id || !id.startsWith("fr0g")) return null;
      const remaining = id.slice(4);
      const reversed = remaining.split("").reverse().join("");
      return reversed.toUpperCase();
    }

    function timeAgo(date) {
      const seconds = Math.floor((new Date() - new Date(date)) / 1000);
      let interval = seconds / 31536000; if (interval > 1) return Math.floor(interval) + "y ago";
      interval = seconds / 2592000; if (interval > 1) return Math.floor(interval) + "mo ago";
      interval = seconds / 86400; if (interval > 1) return Math.floor(interval) + "d ago";
      interval = seconds / 3600; if (interval > 1) return Math.floor(interval) + "h ago";
      interval = seconds / 60; if (interval > 1) return Math.floor(interval) + "m ago";
      return "just now";
    }

    function parseMemo(memoText) {
      const trimmed = memoText.trim();
      const parts = trimmed.split(";");
      const numStr = parts[0].trim();
      if (!/^\d+$/.test(numStr)) return null;
      const index = parseInt(numStr, 10);
      const description = parts.length > 1 ? parts.slice(1).join(";").trim() : "No description";
      return { index, description: description.length > 25 ? description.substring(0,25) : description };
    }

    async function fetchIndexerMemos(fr0gId) {
      const addr = fr0gToStellar(fr0gId);
      if (!addr) return [];
      const url = `${HORIZON}/accounts/${addr}/transactions?order=desc&limit=${LIMIT}&include_failed=false`;
      try {
        const r = await fetch(url);
        if (!r.ok) return [];
        const json = await r.json();
        const memos = [];
        for (const tx of json._embedded.records) {
          if (tx.memo_type === "text") {
            const parsed = parseMemo(tx.memo);
            if (parsed) {
              memos.push({
                index: parsed.index,
                description: parsed.description,
                from_fr0g: "fr0g" + tx.source_account.split("").reverse().join("").toLowerCase(),
                time: tx.created_at,
                tx: tx.hash,
                category: Object.keys(INDEXERS).find(k => INDEXERS[k] === fr0gId) || "Unknown"
              });
            }
          }
        }
        return memos.sort((a,b) => new Date(b.time) - new Date(a.time));
      } catch(e) { return []; }
    }

    function renderFeed(items) {
      const feedEl = document.getElementById('feed');
      feedEl.innerHTML = '';
      if (items.length === 0) {
        feedEl.innerHTML = `<div style="text-align:center;padding:5rem 1rem;color:var(--text-light);">No posts yet.<br>Be the first ‚Äî go to Upload!</div>`;
        return;
      }
      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="preview">${getPreviewHTML(item)}</div>
          <div class="card-content">
            <div class="description">${item.description}</div>
            <div class="id-index">${item.from_fr0g.slice(0,12)}...#${item.index}</div>
            <div class="time">${timeAgo(item.time)}</div>
            <div class="post-actions">
              ‚ù§Ô∏è <span style="font-size:0.95rem;margin-left:4px;">${Math.floor(Math.random()*38)+5}</span>
              üí¨ <span style="font-size:0.95rem;margin-left:4px;">${Math.floor(Math.random()*9)+1}</span>
            </div>
          </div>
        `;
        card.addEventListener('click', () => openPopup(item));
        feedEl.appendChild(card);
      });
    }

    async function refreshFeed() {
      document.getElementById('feed').innerHTML = `<div style="text-align:center;padding:5rem 1rem;color:var(--text-light);">Loading fresh posts...</div>`;
      let allItems = [];
      if (currentFilter === 'ALL') {
        for (const cat in INDEXERS) {
          const memos = await fetchIndexerMemos(INDEXERS[cat]);
          allItems.push(...memos.map(m => ({...m, category: cat})));
        }
      } else {
        const memos = await fetchIndexerMemos(INDEXERS[currentFilter]);
        allItems = memos.map(m => ({...m, category: currentFilter}));
      }
      const unique = new Map();
      allItems.forEach(m => unique.set(`${m.from_fr0g}#${m.index}`, m));
      const sorted = Array.from(unique.values()).sort((a,b) => new Date(b.time) - new Date(a.time));
      renderFeed(sorted);
    }

    function showSection(sec) {
      currentFilter = ['ALL','IMAGES','VIDEOS','WEBSITES','TEXT','RAW'].includes(sec) ? sec : 'ALL';
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      const activeTab = document.querySelector(`.tab[data-cat="${sec}"]`);
      if (activeTab) activeTab.classList.add('active');

      document.getElementById('feed-container').style.display = ['ALL','IMAGES','VIDEOS','WEBSITES','TEXT','RAW'].includes(sec) ? 'block' : 'none';
      document.getElementById('upload-container').style.display = sec === 'UPLOAD' ? 'block' : 'none';
      document.getElementById('id-container').style.display = sec === 'ID' ? 'block' : 'none';

      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      if (sec === 'UPLOAD') document.querySelectorAll('.nav-item')[1].classList.add('active');
      else if (sec === 'ID') document.querySelectorAll('.nav-item')[2].classList.add('active');
      else document.querySelectorAll('.nav-item')[0].classList.add('active');

      if (['ALL','IMAGES','VIDEOS','WEBSITES','TEXT','RAW'].includes(sec)) refreshFeed();
    }

    function openPopup(item) {
      const popup = document.getElementById('popup');
      const explorerUrl = `https://stellar.expert/explorer/testnet/tx/${item.tx}`;
      document.getElementById('popup-title').textContent = item.description;
      document.getElementById('popup-body').innerHTML = `
        <div class="preview" style="height:240px;border-radius:16px;margin-bottom:2rem;">${getPreviewHTML(item)}</div>
        <div style="line-height:1.75;">
          <strong>Posted by</strong> ${item.from_fr0g}<br>
          <strong>Category</strong> ${item.category}<br>
          <strong>Index</strong> #${item.index}<br>
          <strong>Time</strong> ${timeAgo(item.time)}
        </div>
        <a href="${explorerUrl}" target="_blank" style="display:block;margin-top:2.5rem;padding:1rem;background:var(--accent);color:#000;border-radius:9999px;text-align:center;text-decoration:none;font-weight:700;">View on Stellar Explorer</a>
      `;
      popup.style.display = 'flex';
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
    }

    function showManual() {
      const cat = document.getElementById('upload-category').value;
      let idx = parseInt(document.getElementById('upload-index').value) || Math.floor(Math.random()*999)+1;
      let desc = document.getElementById('upload-desc').value.trim().slice(0,25) || "My fr0g post";
      const indexer = INDEXERS[cat];
      const memoText = `${idx};${desc}`;
      const shortAddr = indexer.slice(0,18) + "..." + indexer.slice(-8);

      const html = `
        <strong style="display:block;margin-bottom:1rem;">Manual upload (works on any Stellar wallet)</strong>
        <div style="background:#000;padding:1rem;border-radius:12px;font-family:monospace;font-size:0.95rem;margin-bottom:1.2rem;">
          Send any amount of XLM to:<br>
          <span style="color:var(--accent);word-break:break-all;">${indexer}</span>
          <button onclick="copyText('${indexer}')" style="float:right;font-size:0.8rem;padding:4px 10px;">Copy</button>
        </div>
        <div style="background:#000;padding:1rem;border-radius:12px;font-family:monospace;font-size:0.95rem;">
          Use this exact memo:<br>
          <span style="color:var(--accent);">${memoText}</span>
          <button onclick="copyText('${memoText}')" style="float:right;font-size:0.8rem;padding:4px 10px;">Copy Memo</button>
        </div>
        <p style="margin-top:1.8rem;font-size:0.95rem;color:var(--text-light);">Your wallet address instantly becomes your fr0g ID. Post appears in the feed within seconds.</p>
      `;
      const previewDiv = document.getElementById('upload-preview');
      previewDiv.innerHTML = html;
      previewDiv.style.display = 'block';
    }

    async function connectFreighter() {
      if (typeof freighterApi === "undefined") {
        alert("‚ùå Freighter wallet extension not found.\n\nInstall Freighter from freighter.app (works on Chrome / Brave / Edge)\n\nOn Android use manual instructions above.");
        return;
      }
      try {
        const pk = await freighterApi.getPublicKey();
        window.currentPublicKey = pk;
        document.getElementById('connected-pk').textContent = pk.slice(0,8) + "..." + pk.slice(-8);
        document.getElementById('connected-status').style.display = 'block';
        document.getElementById('freighter-btn').style.display = 'none';
      } catch(e) {
        alert("Connection cancelled or failed.");
      }
    }

    async function realPost() {
      if (!window.currentPublicKey) {
        alert("Please connect Freighter first");
        return;
      }
      const cat = document.getElementById('upload-category').value;
      let idx = parseInt(document.getElementById('upload-index').value) || Math.floor(Math.random()*9999)+1;
      let desc = document.getElementById('upload-desc').value.trim().slice(0,25) || "fr0g post";
      const indexer = INDEXERS[cat];
      const memoText = `${idx};${desc}`;

      const server = new StellarSdk.Horizon.Server(HORIZON);
      try {
        const account = await server.loadAccount(window.currentPublicKey);
        const txBuilder = new StellarSdk.TransactionBuilder(account, {
          fee: StellarSdk.BASE_FEE,
          networkPassphrase: StellarSdk.Networks.TESTNET
        })
        .addOperation(StellarSdk.Operation.payment({
          destination: indexer,
          asset: StellarSdk.Asset.native(),
          amount: "0.00001"
        }))
        .addMemo(StellarSdk.Memo.text(memoText))
        .setTimeout(StellarSdk.TimeoutInfinite);

        const tx = txBuilder.build();
        const signedXDR = await freighterApi.signTransaction(tx.toXDR(), { networkPassphrase: StellarSdk.Networks.TESTNET });
        const signedTx = StellarSdk.TransactionBuilder.fromXDR(signedXDR, StellarSdk.Networks.TESTNET);
        const result = await server.submitTransaction(signedTx);

        alert(`‚úÖ REAL UPLOAD SUCCESSFUL!\n\nTransaction hash:\n${result.hash}\n\nYour post is live on fr0gnet right now!`);
        document.getElementById('upload-preview').style.display = 'none';
        setTimeout(refreshFeed, 2500);
        showSection('ALL');
      } catch(e) {
        console.error(e);
        alert("Upload failed: " + (e.message || "Unknown error"));
      }
    }

    function generateID() {
      let key = document.getElementById('stellar-input').value.trim().toUpperCase();
      if (key && (!key.startsWith('G') || key.length !== 56)) {
        alert("Please enter a valid Stellar public key starting with G (56 characters)");
        return;
      }
      if (!key) {
        alert("Paste your Stellar public key or use Random button");
        return;
      }
      const reversed = key.split('').reverse().join('').toLowerCase();
      const fr0gID = 'fr0g' + reversed;
      document.getElementById('fr0g-output').textContent = fr0gID;
      document.getElementById('id-result').style.display = 'block';
    }

    function generateRandomID() {
      const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
      let key = 'G';
      for (let i = 1; i < 56; i++) {
        key += alphabet[Math.floor(Math.random() * alphabet.length)];
      }
      document.getElementById('stellar-input').value = key;
      const reversed = key.split('').reverse().join('').toLowerCase();
      const fr0gID = 'fr0g' + reversed;
      document.getElementById('fr0g-output').textContent = fr0gID;
      document.getElementById('id-result').style.display = 'block';
    }

    function copyText(text) {
      navigator.clipboard.writeText(text).then(() => {
        const toast = document.createElement('div');
        toast.style.cssText = 'position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:#00eaff;color:#000;padding:12px 26px;border-radius:9999px;font-weight:700;box-shadow:0 4px 20px rgba(0,0,0,0.3);z-index:9999;';
        toast.textContent = '‚úÖ Copied!';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 1600);
      });
    }

    function copyFr0gID() {
      const id = document.getElementById('fr0g-output').textContent;
      if (id) copyText(id);
    }

    function initTheme() {
      const toggle = document.getElementById('theme-toggle');
      let theme = localStorage.getItem('fr0gnet-theme') || 'dark';
      document.documentElement.dataset.theme = theme;
      toggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      toggle.addEventListener('click', () => {
        theme = theme === 'dark' ? 'light' : 'dark';
        document.documentElement.dataset.theme = theme;
        localStorage.setItem('fr0gnet-theme', theme);
        toggle.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      initTheme();
      
      const descArea = document.getElementById('upload-desc');
      const countEl = document.getElementById('char-count');
      descArea.addEventListener('input', () => {
        countEl.textContent = (25 - descArea.value.length) + '/25';
      });

      showSection('ALL');
      setInterval(refreshFeed, UPDATE_INTERVAL);

      const popupEl = document.getElementById('popup');
      popupEl.addEventListener('click', e => { if (e.target === popupEl) closePopup(); });
      document.addEventListener('keydown', e => { if (e.key === 'Escape') closePopup(); });
    });
  </script>
</body>
</html>
